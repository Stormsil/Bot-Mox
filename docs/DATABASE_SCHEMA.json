{
  "_meta": {
    "version": "2.2.0",
    "last_updated": "2026-02-07",
    "description": "Bot-Mox Firebase Realtime Database schema after settings/resources/workspace unification",
    "source": [
      "Live RTDB snapshot (botfarm-d69b7)",
      "Current app code paths in bot-mox/src"
    ],
    "notes": [
      "Top-level structure is normalized to: bots, finance, resources, settings, users, workspace",
      "Legacy roots (app_settings, bot_licenses, proxies, subscriptions, projects, notes_v2, notes_index, scheduleLastParams, reference_data) were migrated",
      "Some nodes are lazy-initialized and can be absent until first save (for example settings/proxy, settings/vmgenerator, workspace/kanban_tasks)"
    ]
  },

  "root": {
    "_schema": {
      "bots": "map<Bot>",
      "finance": "Finance",
      "resources": "Resources",
      "settings": "Settings",
      "users": "map<User>",
      "workspace": "Workspace"
    }
  },

  "bots": {
    "_description": "Active bots",
    "_schema": {
      "$bot_id": {
        "id": "string - bot UUID",
        "name": "string | optional - display name",
        "project_id": "string - key from settings/projects (e.g. wow_tbc)",
        "status": "string - offline | prepare | leveling | profession | farming | banned",

        "character": {
          "name": "string",
          "level": "number",
          "class": "string",
          "race": "string",
          "server": "string",
          "faction": "string - alliance | horde",
          "updated_at": "number | optional"
        },

        "account": {
          "email": "string",
          "password": "string",
          "bnet_created_at": "number | optional",
          "mail_created_at": "number | optional",
          "mail_provider": "string | optional"
        },

        "person": {
          "first_name": "string",
          "last_name": "string",
          "birth_date": "string - DD-MM-YYYY",
          "country": "string",
          "city": "string",
          "address": "string",
          "zip": "string"
        },

        "generation_locks": {
          "character_name": "boolean | optional",
          "account_email": "boolean | optional",
          "account_password": "boolean | optional",
          "person_data": "boolean | optional",
          "schedule": "boolean | optional"
        },

        "vm": {
          "name": "string",
          "ip": "string",
          "created_at": "string - ISO datetime"
        },

        "schedule": {
          "version": "number",
          "timezone": "string",
          "allowedWindows": "array<{ start: string, end: string }> | optional",
          "days": "array<ScheduleDay> - 7 elements (Sunday..Saturday)",
          "updated_at": "number"
        },

        "leveling": {
          "current_level": "number",
          "target_level": "number",
          "xp_current": "number",
          "xp_required": "number",
          "location": "string",
          "started_at": "number",
          "finished_at": "number"
        },

        "professions": {
          "$profession": {
            "name": "string",
            "skill_points": "number",
            "max_skill_points": "number",
            "started_at": "number",
            "finished_at": "number"
          }
        },

        "farm": {
          "total_gold": "number",
          "session_start": "number",
          "location": "string",
          "profile": "string",
          "all_farmed_gold": "number"
        },

        "proxy": {
          "full_string": "string",
          "type": "string - none | http | socks5",
          "ip": "string",
          "port": "number",
          "login": "string",
          "password": "string",
          "provider": "string",
          "country": "string",
          "fraud_score": "number",
          "VPN": "boolean | optional",
          "Proxy": "boolean | optional",
          "detect_country": "boolean | optional",
          "created_at": "number",
          "expires_at": "number"
        },

        "telemetry": {
          "custom_status_code": "number",
          "wow_status_code": "number",
          "smart_loot_session": "number",
          "deaths_session": "number",
          "durability_avg": "number",
          "bag_slots_free": "number",
          "last_sync_ts": "number",
          "pixel_block_0_header": "string",
          "pixel_block_12_footer": "string",
          "scan_status": "string"
        },

        "monitor": {
          "screenshot_request": "boolean",
          "screenshot_url": "string | null | optional",
          "screenshot_timestamp": "number | null | optional",
          "status": "string - idle | requested | uploading | error"
        },

        "lifecycle": {
          "current_stage": "string | optional",
          "previous_status": "string | optional",
          "stage_transitions": "array<object> | optional",
          "ban_details": "object | optional"
        },

        "created_at": "number | optional",
        "updated_at": "number | optional",
        "last_seen": "number | optional"
      }
    },
    "_schedule_day": {
      "enabled": "boolean",
      "sessions": "array<ScheduleSession>"
    },
    "_schedule_session": {
      "id": "string",
      "start": "string - HH:MM",
      "end": "string - HH:MM",
      "enabled": "boolean",
      "type": "string - active | break",
      "profile": "string | optional"
    }
  },

  "finance": {
    "_description": "Finance module",
    "_schema": {
      "operations": {
        "$operation_id": {
          "type": "string - income | expense",
          "category": "string - sale | proxy | subscription_bot | subscription_game | bot_license | other",
          "bot_id": "string | null | optional",
          "project_id": "string | null | optional",
          "description": "string",
          "amount": "number",
          "currency": "string - USD | gold",
          "gold_amount": "number | optional",
          "gold_price_at_time": "number | null | optional",
          "date": "number - timestamp",
          "created_at": "number",
          "updated_at": "number | optional"
        }
      },
      "daily_stats": {
        "$date": {
          "date": "string - YYYY-MM-DD",
          "total_expenses": "number",
          "total_revenue": "number",
          "net_profit": "number",
          "active_bots": "number",
          "total_farmed": "object | optional"
        }
      },
      "gold_price_history": "object | optional | deprecated"
    }
  },

  "resources": {
    "_description": "Shared resource pool",
    "_schema": {
      "licenses": {
        "$license_id": {
          "key": "string",
          "type": "string",
          "status": "string - active | expired | revoked",
          "bot_ids": "array<string>",
          "expires_at": "number",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "proxies": {
        "$proxy_id": {
          "ip": "string",
          "port": "number",
          "login": "string",
          "password": "string",
          "provider": "string",
          "country": "string",
          "country_code": "string | optional",
          "type": "string - http | socks5",
          "status": "string - active | expired | banned",
          "bot_id": "string | null",
          "fraud_score": "number",
          "vpn": "boolean | optional",
          "proxy": "boolean | optional",
          "tor": "boolean | optional",
          "bot_status": "boolean | optional",
          "isp": "string | optional",
          "organization": "string | optional",
          "city": "string | optional",
          "region": "string | optional",
          "zip_code": "string | optional",
          "timezone": "string | optional",
          "latitude": "number | optional",
          "longitude": "number | optional",
          "last_checked": "number | optional",
          "expires_at": "number",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "subscriptions": {
        "$subscription_id": {
          "bot_id": "string",
          "type": "string - wow | bot | proxy | vpn | other",
          "status": "string - active | cancelled",
          "expires_at": "number",
          "auto_renew": "boolean | optional",
          "account_email": "string | optional",
          "project_id": "string | optional",
          "notes": "string | optional",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "virtual_machines": {
        "updated_at": "number | optional",
        "$vm_id": {
          "id": "string | optional",
          "name": "string | optional",
          "provider": "string | optional",
          "project_id": "string | optional",
          "node": "string | optional",
          "status": "string | optional",
          "ip": "string | optional",
          "created_at": "number | optional",
          "updated_at": "number | optional"
        }
      }
    }
  },

  "settings": {
    "_description": "Single settings root",
    "_schema": {
      "alerts": {
        "warning_days": "number - global warning threshold",
        "updated_at": "number",
        "updated_by": "string | optional"
      },

      "api_keys": {
        "ipqs": {
          "api_key": "string",
          "enabled": "boolean"
        },
        "telegram": {
          "bot_token": "string",
          "chat_id": "string",
          "enabled": "boolean"
        }
      },

      "proxy": {
        "auto_check_on_add": "boolean",
        "fraud_score_threshold": "number",
        "check_interval_hours": "number"
      },

      "notifications": {
        "events": {
          "bot_banned": "boolean",
          "bot_offline": "boolean",
          "bot_online": "boolean",
          "level_up": "boolean",
          "profession_maxed": "boolean",
          "low_fraud_score": "boolean",
          "daily_report": "boolean"
        }
      },

      "finance": {
        "chart_config": "array<ChartSeriesConfig>"
      },

      "schedule": {
        "last_params": "ScheduleGenerationParams",
        "templates": {
          "$template_id": {
            "name": "string",
            "params": "ScheduleGenerationParams",
            "created_at": "number",
            "updated_at": "number"
          }
        }
      },

      "generators": {
        "account": {
          "lastSettings": {
            "passwordOptions": {
              "length": "number",
              "uppercase": "boolean",
              "lowercase": "boolean",
              "numbers": "boolean",
              "symbols": "boolean"
            },
            "selectedDomain": "string",
            "customDomain": "string",
            "useCustomDomain": "boolean"
          },
          "defaultTemplateId": "string | optional",
          "templates": {
            "$template_id": {
              "name": "string",
              "created_at": "number",
              "settings": "same as account.lastSettings"
            }
          }
        },
        "person_data": {
          "$country_key": {
            "names": "array<{ firstName: string, lastName: string }>",
            "addresses": "array<object>"
          }
        }
      },

      "projects": {
        "$project_id": {
          "id": "string",
          "name": "string",
          "game": "string",
          "expansion": "string",
          "max_level": "number",
          "currency": "string",
          "currency_symbol": "string",
          "gold_price_usd": "number | optional",
          "server_region": "string",
          "professions": "array<string>",
          "referenceData": {
            "servers": "map<GameServer>",
            "races": "map<GameRace>",
            "classes": "map<GameClass>",
            "factions": "map<GameFaction>"
          },
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "theme": {
        "palettes": {
          "light": "map<css_variable, hex_color>",
          "dark": "map<css_variable, hex_color>"
        },
        "presets": {
          "$preset_id": {
            "id": "string",
            "name": "string",
            "palettes": "same as theme.palettes",
            "created_at": "number",
            "updated_at": "number"
          }
        },
        "active_preset_id": "string | optional",
        "updated_at": "number",
        "updated_by": "string | optional"
      },

      "ui": {
        "resource_tree": {
          "expandedKeys": "array<string>",
          "visibleStatuses": "array<string>",
          "showFilters": "boolean",
          "updated_at": "number"
        }
      },

      "vmgenerator": {
        "proxmox": {
          "url": "string",
          "username": "string",
          "password": "string",
          "node": "string"
        },
        "ssh": {
          "host": "string",
          "port": "number",
          "username": "string",
          "password": "string | optional",
          "privateKeyPath": "string | optional",
          "useKeyAuth": "boolean"
        },
        "storage": {
          "options": "array<string>",
          "default": "string"
        },
        "format": {
          "options": "array<string>",
          "default": "string"
        },
        "template": {
          "vmId": "number",
          "name": "string"
        },
        "hardware": {
          "cores": "number",
          "sockets": "number",
          "memory": "number",
          "balloon": "number",
          "cpu": "string",
          "onboot": "boolean",
          "agent": "boolean"
        },
        "hardwareApply": {
          "applyCpu": "boolean",
          "applyOnboot": "boolean",
          "applyAgent": "boolean"
        },
        "profiles": {
          "$profile_id": {
            "name": "string",
            "created_at": "number",
            "updated_at": "number",
            "hardware": {
              "cores": "number",
              "sockets": "number",
              "memory": "number",
              "balloon": "number",
              "cpu": "string",
              "onboot": "boolean",
              "agent": "boolean"
            }
          }
        },
        "services": {
          "proxmoxUrl": "string",
          "tinyFmUrl": "string",
          "syncThingUrl": "string",
          "proxmoxAutoLogin": "boolean",
          "tinyFmAutoLogin": "boolean",
          "tinyFmUsername": "string",
          "tinyFmPassword": "string",
          "syncThingAutoLogin": "boolean",
          "syncThingUsername": "string",
          "syncThingPassword": "string"
        }
      }
    },

    "_schedule_generation_params": {
      "startTime": "string - HH:MM",
      "endTime": "string - HH:MM",
      "useSecondWindow": "boolean",
      "startTime2": "string - HH:MM",
      "endTime2": "string - HH:MM",
      "targetActiveMinutes": "number",
      "minSessionMinutes": "number",
      "minBreakMinutes": "number",
      "randomOffsetMinutes": "number",
      "profile": "string | optional"
    }
  },

  "users": {
    "_description": "App users",
    "_schema": {
      "$user_id": {
        "id": "string",
        "email": "string",
        "name": "string",
        "role": "string - admin | operator | viewer",
        "permissions": {
          "bots": "array<string>",
          "finance": "array<string>",
          "settings": "array<string>",
          "archive": "array<string>"
        },
        "notifications": {
          "bot_start": "boolean",
          "bot_status_change": "boolean",
          "bot_offline": "boolean",
          "bot_banned": "boolean",
          "daily_report": "boolean",
          "low_roi_alert": "boolean"
        },
        "telegram_id": "string | null",
        "last_login": "number",
        "created_at": "number"
      }
    }
  },

  "workspace": {
    "_description": "Workspace module",
    "_schema": {
      "notes_v2": {
        "$note_id": {
          "id": "string",
          "title": "string",
          "content": "string - markdown",
          "tags": "array<string> | optional",
          "bot_id": "string | null | optional",
          "project_id": "string | null | optional",
          "is_pinned": "boolean",
          "created_by": "string | optional",
          "blocks": "map<NoteBlock> | optional | deprecated",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "notes_index": {
        "$note_id": {
          "id": "string",
          "title": "string",
          "preview": "string",
          "tags": "array<string> | optional",
          "bot_id": "string | null | optional",
          "project_id": "string | null | optional",
          "is_pinned": "boolean",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "calendar_events": {
        "$event_id": {
          "title": "string",
          "description": "string",
          "date": "string - YYYY-MM-DD",
          "linked_note_id": "string | null | optional",
          "created_at": "number",
          "updated_at": "number"
        }
      },

      "kanban_tasks": {
        "$task_id": {
          "title": "string",
          "description": "string",
          "status": "string - todo | in_progress | done",
          "due_date": "string | null - YYYY-MM-DD",
          "order": "number",
          "created_at": "number",
          "updated_at": "number"
        }
      }
    }
  },

  "security_rules_template": {
    "_description": "Suggested RTDB rules aligned with current structure",
    "rules": {
      ".read": "auth != null",
      ".write": "auth != null && auth.token.admin === true",

      "bots": {
        "$bot_id": {
          ".validate": "newData.hasChildren(['id', 'project_id', 'status', 'character'])"
        }
      },

      "finance": {
        "operations": {
          "$op_id": {
            ".validate": "newData.hasChildren(['type', 'category', 'amount', 'currency', 'date'])"
          }
        }
      },

      "workspace": {
        "notes_v2": {
          "$note_id": {
            ".validate": "newData.hasChildren(['id', 'title', 'created_at', 'updated_at'])"
          }
        },
        "notes_index": {
          "$note_id": {
            ".validate": "newData.hasChildren(['id', 'title', 'updated_at'])"
          }
        }
      },

      "users": {
        "$user_id": {
          ".read": "auth != null && (auth.token.admin === true || auth.uid === $user_id)"
        }
      }
    }
  },

  "indexes_recommendations": {
    "bots": ["status", "project_id", "last_seen"],
    "finance/operations": ["date", "type", "bot_id", "project_id"],
    "resources/licenses": ["status", "expires_at"],
    "resources/proxies": ["status", "expires_at", "bot_id"],
    "resources/subscriptions": ["status", "expires_at", "bot_id", "type"],
    "workspace/notes_v2": ["updated_at", "created_at", "is_pinned", "bot_id", "project_id"],
    "workspace/notes_index": ["updated_at", "created_at", "is_pinned", "bot_id", "project_id"],
    "workspace/calendar_events": ["date", "updated_at"],
    "workspace/kanban_tasks": ["status", "order", "updated_at"]
  },

  "legacy_nodes_removed": [
    "app_settings",
    "bot_licenses",
    "proxies",
    "subscriptions",
    "subscriptions_summary",
    "projects",
    "reference_data",
    "notes",
    "notes_v2",
    "notes_index",
    "scheduleLastParams",
    "scheduleTemplates",
    "generatorTemplates",
    "person_data"
  ]
}
